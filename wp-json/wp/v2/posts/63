{"id":63,"date":"2020-11-14T22:11:00","date_gmt":"2020-11-14T22:11:00","guid":{"rendered":"http:\/\/localhost:8000\/?p=63"},"modified":"2021-02-02T07:05:33","modified_gmt":"2021-02-02T07:05:33","slug":"installing-composer-in-the-php-docker-image","status":"publish","type":"post","link":"http:\/\/localhost:8000\/2020\/11\/14\/installing-composer-in-the-php-docker-image\/","title":{"rendered":"Installing Composer in the official PHP Docker image"},"content":{"rendered":"\n<p><a href=\"https:\/\/getcomposer.org\/\">Composer<\/a> is a dependency management tool for PHP that has been around for almost 8 years now, but it&#8217;s still not included in the <a href=\"https:\/\/hub.docker.com\/_\/php\">official Docker images<\/a>.<\/p>\n\n\n\n<p>Composer recommends to automate the install using <a href=\"https:\/\/getcomposer.org\/doc\/faqs\/how-to-install-composer-programmatically.md\">their script<\/a>. It needs to be downloaded, but the <code>php:7.4-apache<\/code> image does not contain <code>wget<\/code>. <\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>FROM php:7.4-apache\n\nRUN apt update &amp;&amp; apt-get install -y wget\nRUN wget https:\/\/raw.githubusercontent.com\/composer\/getcomposer.org\/76a7060ccb93902cd7576b67264ad91c8a2700e2\/web\/installer -O - -q | php -- --quiet --version=1.10.15\nRUN mv composer.phar \/usr\/local\/bin\/composer\n\n# Add your project code to Docker image here\n# ENV APP_BASE_DIR=\/var\/www\/app \\\n#     APACHE_DOCUMENT_ROOT=\/var\/www\/app\/web\n# ADD . $APP_BASE_DIR\n# And change directory to your code\n# cd $APP_BASE_DIR\n\nRUN composer install<\/code><\/pre>\n\n\n\n<p>We also want to use <a href=\"https:\/\/getcomposer.org\/doc\/00-intro.md#globally\">composer globally<\/a> that&#8217;s why we added <code>mv composer.phar \/usr\/local\/bin\/composer<\/code>. Now we can execute <code>composer<\/code> command from anywhere.<\/p>\n\n\n\n<p>The dependencies are now installed successfully, but we still get the following warning:<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>As there is no 'unzip' command installed zip files are being unpacked using the PHP zip extension.\nThis may cause invalid reports of corrupted archives. Besides, any UNIX permissions (e.g. executable) defined in the archives will be lost.\nInstalling 'unzip' may remediate them.<\/code><\/pre>\n\n\n\n<p>To fix the possibly corrupted archives and UNIX permissions, we need to install the unzip tool. We can also optimize the image to use only one layer to install Composer, and one layer to install dependencies.<\/p>\n\n\n\n<pre class=\"wp-block-code\"><code>FROM php:7.4-apache\n\n# Install Composer\nRUN apt update &amp;&amp; apt-get install -y wget unzip &amp;&amp; \\\n    wget https:\/\/raw.githubusercontent.com\/composer\/getcomposer.org\/76a7060ccb93902cd7576b67264ad91c8a2700e2\/web\/installer -O - -q | php -- --quiet --version=1.10.15 &amp;&amp; \\\n    mv composer.phar \/usr\/local\/bin\/composer\n\n# Add your project code to Docker image here\n# ENV APP_BASE_DIR=\/var\/www\/app \\\n#     APACHE_DOCUMENT_ROOT=\/var\/www\/app\/web\n# ADD . $APP_BASE_DIR\n\nRUN cd $APP_BASE_DIR &amp;&amp; composer install<\/code><\/pre>\n\n\n\n<p>Finally, we have our Dockerfile ready to integrate the build of our app into a CI\/CD pipeline.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Composer is a dependency management tool for PHP that has been around for almost 8 years now, but it&#8217;s still not included in the official Docker images. Composer recommends to automate the install using their script. It needs to be downloaded, but the php:7.4-apache image does not contain wget. We also want to use composer [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"closed","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[10],"tags":[8,2],"jetpack_featured_media_url":"","_links":{"self":[{"href":"http:\/\/localhost:8000\/wp-json\/wp\/v2\/posts\/63"}],"collection":[{"href":"http:\/\/localhost:8000\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"http:\/\/localhost:8000\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"http:\/\/localhost:8000\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"http:\/\/localhost:8000\/wp-json\/wp\/v2\/comments?post=63"}],"version-history":[{"count":7,"href":"http:\/\/localhost:8000\/wp-json\/wp\/v2\/posts\/63\/revisions"}],"predecessor-version":[{"id":72,"href":"http:\/\/localhost:8000\/wp-json\/wp\/v2\/posts\/63\/revisions\/72"}],"wp:attachment":[{"href":"http:\/\/localhost:8000\/wp-json\/wp\/v2\/media?parent=63"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"http:\/\/localhost:8000\/wp-json\/wp\/v2\/categories?post=63"},{"taxonomy":"post_tag","embeddable":true,"href":"http:\/\/localhost:8000\/wp-json\/wp\/v2\/tags?post=63"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}